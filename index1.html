<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Digital Transaction Issues</title>
  <style>
    :root{--accent:#2563eb;--bg:#f7f7fb;--card:#ffffff;--muted:#6b7280}
    body{font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);margin:0;padding:24px;color:#111}
    .container{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
    h1{margin:0;font-size:20px}
    .card{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 1px 3px rgba(2,6,23,0.06)}
    form{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input,select,textarea{width:100%;padding:8px;border:1px solid #e6e9ef;border-radius:8px;font-size:14px}
    textarea{min-height:64px;resize:vertical}
    .btn{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    .btn.danger{background:#ef4444}
    .controls{display:flex;gap:8px;align-items:center}
    .search{padding:8px;border-radius:8px;border:1px solid #e6e9ef}
    table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px}
    th,td{padding:8px;text-align:left;border-bottom:1px solid #f0f2f5}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px}
    .badge.open{background:#fee2e2;color:#991b1b}
    .badge.inprogress{background:#fff7ed;color:#92400e}
    .badge.resolved{background:#ecfccb;color:#154c05}
    .small{font-size:12px;color:var(--muted)}
    .row-actions button{margin-right:6px}
    @media (max-width:640px){ form{grid-template-columns:1fr} header{flex-direction:column;align-items:stretch} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Digital Transaction Issues</h1>
        <div class="small">Report and track UPI / Card / NetBanking / Wallet problems</div>
      </div>
      <div class="controls">
        <input id="q" class="search" placeholder="Search txn id, merchant, description" />
        <select id="filterMethod">
          <option value="">All methods</option>
          <option>UPI</option>
          <option>Card</option>
          <option>NetBanking</option>
          <option>Wallet</option>
        </select>
        <select id="filterStatus">
          <option value="">All status</option>
          <option>Open</option>
          <option>In-Progress</option>
          <option>Resolved</option>
        </select>
        <button id="clearFilters" class="btn" style="background:#6b7280">Clear</button>
      </div>
    </header>

    <section class="card" aria-labelledby="formTitle">
      <h2 id="formTitle" style="margin:0 0 8px 0;font-size:15px">Report an issue</h2>
      <form id="issueForm">
        <div>
          <label>Transaction ID *</label>
          <input id="txnId" required />
        </div>
        <div>
          <label>Date</label>
          <input id="date" type="date" />
        </div>
        <div>
          <label>Amount (₹) *</label>
          <input id="amount" type="number" min="0" step="0.01" required />
        </div>
        <div>
          <label>Payment Method</label>
          <select id="method"><option>UPI</option><option>Card</option><option>NetBanking</option><option>Wallet</option></select>
        </div>
        <div style="grid-column:1 / -1">
          <label>Description *</label>
          <textarea id="desc" required placeholder="Describe problem, reference numbers, any receipts."></textarea>
        </div>
        <div>
          <label>Merchant / Beneficiary</label>
          <input id="merchant" />
        </div>
        <div>
          <label>Status</label>
          <select id="status"><option>Open</option><option>In-Progress</option><option>Resolved</option></select>
        </div>

        <div style="grid-column:1 / -1;text-align:right">
          <input type="hidden" id="editId" />
          <button type="button" id="resetBtn" class="btn" style="background:#6b7280;margin-right:8px">Reset</button>
          <button class="btn" type="submit">Save Issue</button>
        </div>
      </form>
    </section>

    <section style="margin-top:14px">
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <strong>Issues</strong>
          <span id="count" class="small"></span>
        </div>

        <table id="issuesTable" aria-live="polite">
          <thead>
            <tr>
              <th>Txn ID</th>
              <th>Date</th>
              <th>Amount</th>
              <th>Method</th>
              <th>Type</th>
              <th>Status</th>
              <th>Merchant</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <div id="emptyMsg" class="small" style="padding:12px;display:none">No issues found.</div>
      </div>
    </section>
  </div>

  <script>
    // Simple single-file app using localStorage
    const STORAGE_KEY = 'dt_issues_simple';
    const form = document.getElementById('issueForm');
    const tableBody = document.querySelector('#issuesTable tbody');
    const q = document.getElementById('q');
    const filterMethod = document.getElementById('filterMethod');
    const filterStatus = document.getElementById('filterStatus');
    const countEl = document.getElementById('count');
    const emptyMsg = document.getElementById('emptyMsg');

    // basic sample seed data
    function seedIfEmpty() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) {
        const seed = [
          { id: id(), txnId: 'UPI-1001-AXIS', date: dateOffset(-2), amount: 1299, method: 'UPI', type: 'Failed / Pending', status: 'Open', merchant: 'Zomato', desc: 'Debited but merchant not confirmed' },
          { id: id(), txnId: 'CARD-8890', date: dateOffset(-6), amount: 4500, method: 'Card', type: 'Chargeback', status: 'In-Progress', merchant: 'Amazon', desc: 'Unrecognised transaction' },
        ];
        localStorage.setItem(STORAGE_KEY, JSON.stringify(seed));
      }
    }

    function id(){ return Math.random().toString(36).slice(2)+Date.now().toString(36); }
    function dateOffset(days){ const d=new Date(); d.setDate(d.getDate()+days); return d.toISOString().slice(0,10); }

    function load(){ try{return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]')}catch(e){return []} }
    function save(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)) }

    // render table (search + simple filters)
    function render(){
      const data = load();
      const query = q.value.trim().toLowerCase();
      const method = filterMethod.value;
      const status = filterStatus.value;

      let filtered = data.filter(item=>{
        if (method && item.method !== method) return false;
        if (status && item.status !== status) return false;
        if (!query) return true;
        const hay = (item.txnId+' '+item.merchant+' '+item.desc+' '+item.type+' '+item.method).toLowerCase();
        return hay.includes(query);
      });

      tableBody.innerHTML = '';
      countEl.textContent = `${filtered.length} shown (total ${data.length})`;

      if (filtered.length === 0) {
        emptyMsg.style.display = 'block';
      } else {
        emptyMsg.style.display = 'none';
      }

      for (const it of filtered) {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td><strong>${escapeHtml(it.txnId)}</strong><div class="small">${escapeHtml(it.type)}</div></td>
          <td>${escapeHtml(it.date || '')}</td>
          <td>₹${Number(it.amount||0).toLocaleString()}</td>
          <td>${escapeHtml(it.method)}</td>
          <td class="small">${escapeHtml(it.type)}</td>
          <td>${statusBadge(it.status)}</td>
          <td>${escapeHtml(it.merchant||'—')}</td>
          <td class="row-actions">
            <button data-id="${it.id}" class="editBtn">Edit</button>
            <button data-id="${it.id}" class="delBtn" style="background:#ef4444;color:#fff;padding:6px;border-radius:6px;border:0">Delete</button>
          </td>
        `;
        tableBody.appendChild(tr);
      }

      // attach handlers
      document.querySelectorAll('.editBtn').forEach(b=>b.onclick = ()=>startEdit(b.dataset.id));
      document.querySelectorAll('.delBtn').forEach(b=>b.onclick = ()=>remove(b.dataset.id));
    }

    function statusBadge(s){
      const cls = s === 'Resolved' ? 'badge resolved' : s === 'In-Progress' ? 'badge inprogress' : 'badge open';
      return `<span class="${cls}">${escapeHtml(s)}</span>`;
    }

    function escapeHtml(text){ return String(text||'').replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

    function startEdit(id){
      const data = load();
      const it = data.find(x=>x.id===id); if(!it) return alert('Not found');
      document.getElementById('txnId').value = it.txnId;
      document.getElementById('date').value = it.date || '';
      document.getElementById('amount').value = it.amount;
      document.getElementById('method').value = it.method;
      document.getElementById('desc').value = it.desc;
      document.getElementById('merchant').value = it.merchant;
      document.getElementById('status').value = it.status;
      document.getElementById('editId').value = it.id;
      window.scrollTo({top:0,behavior:'smooth'});
    }

    function remove(id){
      if (!confirm('Delete this issue?')) return;
      let data = load();
      data = data.filter(x=>x.id !== id);
      save(data);
      render();
    }

    form.addEventListener('submit', e=>{
      e.preventDefault();
      const newItem = {
        txnId: document.getElementById('txnId').value.trim(),
        date: document.getElementById('date').value || dateOffset(0),
        amount: Number(document.getElementById('amount').value || 0),
        method: document.getElementById('method').value,
        type: 'Other', // simple: you can make a type select if needed
        status: document.getElementById('status').value,
        merchant: document.getElementById('merchant').value.trim(),
        desc: document.getElementById('desc').value.trim()
      };
      if (!newItem.txnId || !newItem.amount || !newItem.desc) {
        return alert('Please fill Transaction ID, Amount and Description');
      }

      const editId = document.getElementById('editId').value;
      const data = load();
      if (editId) {
        const idx = data.findIndex(x=>x.id===editId);
        if (idx >= 0) {
          data[idx] = {...data[idx], ...newItem};
          save(data);
          document.getElementById('editId').value = '';
        }
      } else {
        data.unshift({...newItem, id: id()});
        save(data);
      }
      form.reset();
      render();
    });

    document.getElementById('resetBtn').addEventListener('click', ()=>{
      form.reset();
      document.getElementById('editId').value = '';
    });

    // filters & search
    [q, filterMethod, filterStatus].forEach(el => el.addEventListener('input', debounce(render, 200)));
    document.getElementById('clearFilters').addEventListener('click', ()=>{
      q.value=''; filterMethod.value=''; filterStatus.value=''; render();
    });

    // small debounce helper
    function debounce(fn, wait=150){ let t; return function(...a){ clearTimeout(t); t=setTimeout(()=>fn(...a), wait); } }

    // init
    seedIfEmpty();
    render();

    // helpful: expose for console debugging
    window._dt = { load, save };
  </script>
</body>
</html>
